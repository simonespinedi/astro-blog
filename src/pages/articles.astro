---
// src/pages/articles.astro
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('articles');
const tags = Array.from(new Set(posts.flatMap(post => post.data.tags ?? [])));
---

<Layout>
  <main class="centered-article-stuff">
    <section class="article-container">
    <h1 class="article-h1">Articles</h1>
      <ul class="article-list" id="article-list">
        {posts.map(post => (
          <li data-tags={post.data.tags?.join(',') ?? ''}>
            <a href={`/posts/${post.id}`}>
              <h2>{post.data.title}</h2>
            </a>
            <p>{post.data.description}</p>
            <small>{post.data.pubDate.toDateString()}</small>
          </li>
        ))}
      </ul>
    </section>
    <section class="article-tags">
      <aside class="tags-sidebar">
        <h2>Tags</h2>
        <ul>
          {tags.map(tag => (
            <li><a href="#" class="tag-link" data-tag={tag}>{tag}</a></li>
          ))}
        </ul>
      </aside>
    </section>
  </main>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const tagLinks = document.querySelectorAll('.tag-link');
    const articles = document.querySelectorAll('#article-list li');

    tagLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const tag = link.dataset.tag;
        articles.forEach(article => {
          const tags = article.dataset.tags.split(',');
          if (tags.includes(tag)) {
            article.style.display = '';
          } else {
            article.style.display = 'none';
          }
        });
      });
    });
  });
</script>
</Layout>
